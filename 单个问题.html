<!DOCTYPE html>
<html lang="zh">
<!-- need to replace example and add ui -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IT LOVE 历史问题</title>
    <!-- LOADING STYLESHEETS -->
    <!--     <link href="../css/bootstrap.css" rel="stylesheet"> -->
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <!--     <link href="../css/style.css" rel="stylesheet"> -->
    <link href="../css/newstyle.css" rel="stylesheet">
    <link href="../css/history-question.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
    <script>
    var config = {
        apiKey: "AIzaSyBZUz6V1Mkmwxpe781P8X6ZC7fPTUyiBIg",
        authDomain: "it-love1.firebaseapp.com",
        databaseURL: "https://it-love1.firebaseio.com",
        projectId: "it-love1",
        storageBucket: "it-love1.appspot.com",
        messagingSenderId: "782043275132"
    };
    firebase.initializeApp(config);
    </script>

    <script>
    /**
     * init firestone
     */
    // Initialize Cloud Firestore through Firebase
    function initApp() {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                document.getElementById('signintop').textContent = '';
                var tag = document.createElement("i");
                tag.setAttribute('class', 'fa fa-key');
                document.getElementById('signintop').appendChild(tag);
                var text = document.createElement("div");
                text.setAttribute('style', 'display: inline;');
                text.textContent = '注销';
                document.getElementById('signintop').appendChild(text);

                document.getElementById('signuptop').style.display = "none";
                var email = "" + user.email;
                var db = firebase.firestore();
                var ref = db.collection("user").doc(email);
                ref.get().then(function(doc) {
                    if (doc.exists) {
                        if (typeof doc.data == 'function') {
                            var dic = doc.data();
                            document.getElementById('welcome').textContent = '欢迎 ' + dic["Name"];
                        }
                    } else{
                        console.log("No such document!");
                        document.getElementById('welcome').textContent = '欢迎 xxx （您还未命名）';
                    }});
            } else {
                document.getElementById('system').style.display = "none";
            }
        });
        document.getElementById('signintop').addEventListener('click', toggleSignIn, false);
    }

    function toggleSignIn() {
        if (firebase.auth().currentUser) {
            // [START signout]
            firebase.auth().signOut();
            window.open('../登录.html', "_self");
            // [END signout]
        } else {
        }
    }

    window.onload = function() {
        initApp();
    };
    </script>
</head>

<body>
    <div class="toppest">
        <div class="login-box">
            <div id="signintop">
                            <i class="fa fa-key"></i> 登陆</div>
        </div>
        <div class="login-box" id="signuptop">
            <a href="../email-password.html">
                            <i class="fa fa-pencil"></i> 注册</a>
        </div>
        <div class="login-box" id="system">
            <a href="../系统消息.html">
                            <i class="fa fa-bell"></i> 系统消息</a>
        </div>
        <div class="login-box">
            <div id="welcome">
            </div>
        </div>
    </div>
    <!-- TOP NAVIGATION -->
    <div class="topnav-outline">
        <ul class="topnav">
            <li>
                <a href="../index.html">
                            <i class="fa fa-home"></i> 首页</a>
            </li>
            <li>
                <a href="../提问.html">
                            <i class="fa fa-book"></i> 提问</a>
            </li>
            <li>
                <a href="../回答.html">
                            <i class="fa fa-file-text-o"></i> 回答</a>
            </li>
            <li class="icon">
                <a href="javascript:void(0);" onclick="myFunction()">&#9776;</a>
            </li>
        </ul>
    </div>
    <!-- END TOP NAVIGATION -->
    <!-- MAIN SECTION -->
    <div class="question">
        <div class="row">
            <!-- ARTICLE  -->
            <div id="displayQues"></div>
            <div id="solutions"></div>
            <div class="panel panel-default">
                <div class="article-info">
                    <div class="art-date">
                        <a href="#">
                                                                <i class="fa fa-calendar-o"></i> 20 May, 2016 </a>
                    </div>
                    <div class="art-category">
                        <a href="#">
                                                                    <i class="fa fa-folder"></i> Account Settings </a>
                    </div>
                    <div class="art-comments">
                        <a href="#">
                                                                        <i class="fa fa-comments-o"></i> 4 解决方案 </a>
                    </div>
                </div>
                <div class="article-content">
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam sit amet finibus dui. Fusce ac nulla nec ex ornare vehicula non nec mi. Cras eget nisi sem. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec viverra faucibus magna sed interdum. Phasellus ultrices sagittis molestie. Sed sit amet nisl id risus egestas semper. In porta, arcu eu dignissim vestibulum, sapien justo imperdiet enim, sed facilisis quam justo in neque. Aliquam fermentum arcu eget hendrerit efficitur.
                    </p>
                </div>
                <div class="article-content">
                </div>
            </div>
            <!-- END ARTICLE -->
            <!-- COMMENTS  -->
            <div class="panel panel-default">
                <div class="article-heading">
                    <i class="fa fa-comments-o"></i> 解决方案 (4)
                </div>
                <!-- FIRST LEVEL COMMENT 1 -->
                <div class="article-content">
                    <div class="article-comment-top">
                        <div class="comments-user">
                            <h4> 回答1 </h4>
                            <div class="user-name">John Doe</div>
                            <div class="comment-post-date">Posted On
                                <span class="italics">20 May, 2016</span>
                            </div>
                        </div>
                        <div class="comments-content">
                            <p>
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras in orci velit. Sed sodales diam in massa auctor iaculis. Nunc lacinia vitae nunc vel condimentum. Etiam dignissim pulvinar vulputate. Mauris vitae ex felis. Duis ante mi, faucibus nec sem at, venenatis pretium nibh. Nulla condimentum a risus eu fermentum. Proin dapibus odio ex, vel tempor diam volutpat a. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vivamus fermentum facilisis pellentesque.
                            </p>
                            <div class="article-read-more">
                                <button class="btn btn-default btn-sm">
                                    <i class="fa fa-reply"></i> Reply</button>
                            </div>
                        </div>
                        <!-- SECOND LEVEL COMMENT -->
                        <div class="article-comment-second">
                            <div class="comments-user">
                                <div class="user-name">Quinn Demma</div>
                                <div class="comment-post-date">Posted On
                                    <span class="italics">20 May, 2016</span>
                                </div>
                            </div>
                            <div class="comments-content">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras in orci velit. Sed sodales diam in massa auctor iaculis. Nunc lacinia vitae nunc vel condimentum. Etiam dignissim pulvinar vulputate. Mauris vitae ex felis. Duis ante mi, faucibus nec sem at, venenatis pretium nibh. Nulla condimentum a risus eu fermentum. Proin dapibus odio ex, vel tempor diam volutpat a. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vivamus fermentum facilisis pellentesque.
                                </p>
                            </div>
                        </div>
                        <!-- END SECOND LEVEL COMMENT -->
                    </div>
                </div>
                <!-- END FIRST LEVEL COMMENT 1 -->
            </div>
            <!-- END COMMENTS -->
        </div>
        <div class="sidenav">
            <div id="myChart"></div>
            <div class="heading">
                <i class="fa fa-comment-o"></i> 选择你觉得合适的解决方案
            </div>
            <form method="post" class="comment-form">
                <div class="form-row align-items-center">
                    <div class="col-auto my-1" id="add-solutions">
                        <label class="mr-sm-2" for="inlineFormCustomSelect">Preference</label>
                        <select class="custom-select mr-sm-2" id="inlineFormCustomSelect" onchange="scheduleA.call(this,event,this.value)">
                            <option selected>Choose...</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                    </div>
                    <div class="col-auto my-1">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </form>
            <div class="form-check col-md-8 padding-20 add-button">
                <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                <label class="form-check-label" for="defaultCheck1">
                    从公共社区隐藏
                </label>
            </div>
        </div>
        <!--                 <script type="text/javascript">
                google.charts.load('current', { 'packages': ['corechart'] });
                google.charts.setOnLoadCallback(drawChart);


                function drawChart() {
                    var data = google.visualization.arrayToDataTable([
                        ['回答', '投票总数'],
                        ['回答1', 8],
                        ['回答2', 2],
                        ['回答3', 9],

                    ]);


                    var options = { 'title': '回答意见记录', 'width': 400, 'height': 300 };

                    // Display the chart inside the <div> element with id="piechart"
                    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
                    chart.draw(data, options);
                }
                </script> -->
        <!-- <script type="text/javascript">
                var auth1 = firebase.auth();
                firebase.auth().onAuthStateChanged(function(user){
                    var email1 = ""+user.email;
                    var db = firebase.firestore();
                    var ref1 = db.collection("user").doc(email).collection("Questions").doc("${req.params.questionid}");



                });
            </script> -->
    </div>
    <!-- END MAIN SECTION -->
    <!-- LOADING MAIN JAVASCRIPT -->
    <script src="../js/jquery-2.2.4.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src='https://cdn.rawgit.com/VPenkov/okayNav/master/app/js/jquery.okayNav.js'></script>
    <script type="text/javascript">
    var auth = firebase.auth();
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            //ref = db.collection("user").doc(email).collection("Questions").doc().collection("Images");
            var db = firebase.firestore();
            var email = "" + user.email;
            //WHY THERE ARE TWO COMMENTS QUES????
            var ref = db.collection("user").doc(email).collection("Questions").doc("${req.params.questionid}").collection("Answers").where("Approved", "==", true).;
            var ref1 = db.collection("user").doc(email).collection("Questions").doc("${req.params.questionid}");

            ref1.get().then(function(doc) {
                // var description1 = doc.data().Description;
                // var link1 = doc.data().LinkToImage;
                // console.log(link1);
                // var public1 = doc.data().Public;
                // console.log(public1);
                // console.log(description1);
                // var time1 = doc.data().Time;
                var dic = doc.data();
                var description1 = dic["Description"];
                var link1 = dic["LinkToImage"];
                var time1 = dic["Time"];
                var number = dic["NumberOfAnswers"];

                var child1 = document.createElement("div");
                child1.setAttribute('class', 'comments-user');
                var publicChild = document.createElement("div");
                publicChild.setAttribute('class', 'comment-post-date');
                var desChild1 = document.createElement("div");
                desChild1.setAttribute('class', 'comment-post-date');
                desChild1.innerHTML = "Description: " + description1;
                var dateChild1 = document.createElement("div");
                dateChild1.setAttribute('class', 'comment-post-date');
                dateChild1.innerHTML = "Posted on " + time1;

                var lineChild1 = document.createElement("hr");
                lineChild1.setAttribute('class', 'style-three');
                var father1 = document.createElement("div");
                father1.setAttribute('class', 'article-content');
                var son1 = document.createElement("div");
                son1.setAttribute('class', 'article-comment-top');
                var grandfather1 = document.getElementById("displayQues");
                child1.appendChild(publicChild);
                child1.appendChild(desChild1);
                child1.appendChild(dateChild1);


                ref1.collection("Images").get().then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                        var link2 = doc.data().URL;
                        console.log(link2);
                        var imageChild = document.createElement("img");
                        imageChild.setAttribute('src', link2);
                        child1.appendChild(imageChild);
                    });
                });

                //imageChild.setAttribute('src','link1');
                son1.appendChild(child1);
                father1.appendChild(son1);
                father1.appendChild(lineChild1);
                grandfather1.appendChild(father1);



            });




            //         ref1.get().then(function(querySnapshot) {
            //         querySnapshot.forEach(function(doc) {

            //         console.log("test111");
            //         console.log( " ==> ", doc.data().Description);
            //         console.log( " link ==> ", doc.data().LinkToImage);
            //         var description = doc.data().Description;
            //         var public = doc.data().Public;
            //         var time = doc.data().Time;

            // var child = document.createElement("div");
            // child.setAttribute('class', 'comments-user');


            // var desChild = document.createElement("div");
            // dateChild.setAttribute('class', 'comment-post-date');
            // dateChild.innerHTML = "Description " + description;
            // var dateChild = document.createElement("div");
            // dateChild.setAttribute('class', 'comment-post-date');
            // dateChild.innerHTML = "Posted on " + time;
            // var contentChild = document.createElement("div");
            // contentChild.setAttribute('class', 'comments-content');
            // contentChild.innerHTML = content;
            // var lineChild = document.createElement("hr");
            // lineChild.setAttribute('class', 'style-three');
            // var father = document.createElement("div");
            // father.setAttribute('class', 'article-content');
            // var son = document.createElement("div");
            // son.setAttribute('class', 'article-comment-top');
            // var grandfather = document.getElementById("displayQues");
            // child.appendChild(nameChild);
            // child.appendChild(dateChild);
            // son.appendChild(child);
            // son.appendChild(contentChild);
            // son.appendChild(likeChild); 
            // father.appendChild(son);
            // father.appendChild(lineChild);
            // grandfather.appendChild(father);


            //     });

            // });
            ref.get().then(function(querySnapshot) {
                querySnapshot.forEach(function(doc) {

                    console.log("test111");
                    console.log(" ==> ", doc.data().Approved);
                    var approved = doc.data().Approved;
                    var author = doc.data().Author;
                    var content = doc.data().Content;
                    var likes = doc.data().Likes;
                    var time = doc.data().Time;

                    var child = document.createElement("div");
                    child.setAttribute('class', 'comments-user');


                    var nameChild = document.createElement("div");
                    nameChild.setAttribute('class', 'user-name');
                    nameChild.innerHTML = author;
                    var dateChild = document.createElement("div");
                    dateChild.setAttribute('class', 'comment-post-date');
                    dateChild.innerHTML = "Posted on " + time;
                    var contentChild = document.createElement("div");
                    contentChild.setAttribute('class', 'comments-content');
                    contentChild.innerHTML = content;
                    var likeChild = document.createElement("p");
                    likeChild.innerHTML = "Number of people chose this: " + likes;
                    var lineChild = document.createElement("hr");
                    lineChild.setAttribute('class', 'style-three');
                    var father = document.createElement("div");
                    father.setAttribute('class', 'article-content');
                    var son = document.createElement("div");
                    son.setAttribute('class', 'article-comment-top');
                    var grandfather = document.getElementById("solutions");
                    child.appendChild(nameChild);
                    child.appendChild(dateChild);
                    son.appendChild(child);
                    son.appendChild(contentChild);
                    son.appendChild(likeChild);
                    father.appendChild(son);
                    father.appendChild(lineChild);
                    grandfather.appendChild(father);


                });

            });


        } else {}
    });
    </script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
    var data;
    var chart;

    // Load the Visualization API and the piechart package.
    google.charts.load('current', { 'packages': ['corechart'] });

    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.setOnLoadCallback(drawChart);

    // Callback that creates and populates a data table,
    // instantiates the pie chart, passes in the data and
    // draws it.
    function drawChart() {
        // Create our data table.
        data = new google.visualization.DataTable();
        data.addColumn('string', 'Solutions');
        data.addColumn('number', 'Likes');
        var auth = firebase.auth();
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {

                var db = firebase.firestore();
                var email = "" + user.email;
                //var ref = db.collection("user").doc(email).collection("Questions").doc("${req.params.questionid}").collection("Answers");
                var ref2 = db.collection("user").doc(email).collection("Questions").doc("${req.params.questionid}");
                ref2.get().then(function(doc) {
                    ref2.collection("Answers").where("Approved", "==", true).get().then(function(querySnapshot) {
                        querySnapshot.forEach(function(doc) {
                            console.log(typeof(doc.data()["Author"]));
                            console.log(typeof(doc.data()["Likes"]));
                            data.addRow([doc.data()["Author"], doc.data()["Likes"]]);
                        });
                        var options = {
                            'title': 'How many likes each solution has?',
                            'width': 400,
                            'height': 300
                        };

                        // Instantiate and draw our chart, passing in some options.
                        chart = new google.visualization.BarChart(document.getElementById('myChart'));
                        google.visualization.events.addListener(chart, 'select', selectHandler);
                        chart.draw(data, options);
                    });
                });
            } else {}
        });

        //         ''+

        // data.addRows([          
        //   ['Mushrooms', 3],
        //   ['Onions', 1],
        //   ['Olives', 1],
        //   ['Zucchini', 1],
        //   ['Pepperoni', 2]
        // ]);

        // Set chart options

    }

    function selectHandler() {
        var selectedItem = chart.getSelection()[0];
        var value = data.getValue(selectedItem.row, 0);
        alert('The user selected ' + value);
    }
    </script>
</body>

</html>