<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IT LOVE回答</title>
    <!-- LOADING STYLESHEETS -->
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
    <script>
    var config = {
        apiKey: "AIzaSyBZUz6V1Mkmwxpe781P8X6ZC7fPTUyiBIg",
        authDomain: "it-love1.firebaseapp.com",
        databaseURL: "https://it-love1.firebaseio.com",
        projectId: "it-love1",
        storageBucket: "it-love1.appspot.com",
        messagingSenderId: "782043275132"
    };
    firebase.initializeApp(config);
    </script>
    <script>
    function check(des, string) {
        var index = 0;
        var changingstring;
        for (var i = 0; i < string.length; i++) {
            for (var k = 0; k <= i; k++) {
                changingstring = string.substring(k, k + string.length - i);
                //if(des.includes(changingstring)) index ++;
                for (var j = 0; j <= des.length - changingstring.length; j++) {
                    if (des.substring(j, j + changingstring.length) == changingstring) index++;
                }
            }

        }
        return index;


    }

    var db = firebase.firestore();
    var ref = db.collection("Questions");
    ref.get().then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {

            console.log("test" + doc.id);
            // doc.data() is never undefined for query doc snapshots

            //console.log(doc.id, " => ", doc.data());
            var dic = doc.data();

            var desc = dic["Description"];

            return ref.doc(doc.id).update({ index: check(desc, "${req.params.searchcontent}") });
        });
    });

    var newRef = ref.where("index", ">", 0).orderBy("index");
    newRef.get().then(function(querySnapshot3) {
        querySnapshot3.forEach(function(doc) {
            var dic = doc.data();
            //console.log(author["Author"]);
            var author = dic["Author"];
            var desc = dic["Description"];
            var link = dic["LinkToImage"];
            var public = dic["Public"];
            var time = dic["Time"];


            var ahref = document.createElement("a");
            ahref.setAttribute('href', 'https://it-love1.firebaseapp.com/questions/' + doc.id);
            var father = document.createElement("div");
            father.setAttribute('class', 'panel panel-default');
            var authorChild = document.createElement("p");
            authorChild.innerHTML = author;
            var descChild = document.createElement("div");
            descChild.innerHTML = desc;
            descChild.setAttribute('class', 'article-content');
            var timeChild = document.createElement("div");
            timeChild.innerHTML = time;
            timeChild.setAttribute('class', 'art-date');
            father.appendChild(authorChild);
            father.appendChild(descChild);
            father.appendChild(timeChild);
            ahref.appendChild(father);

            var grandfather = document.getElementById("allQ");
            grandfather.appendChild(ahref);
        });
    });

    //if(dic["Description"].includes("${req.params.searchcontent}")){

    //add html

    //} 

    // <div class="panel panel-default">
    //                         <div class="article-heading-abb">
    //                             <a href="单个回答.html">
    //                                 <i class="fa fa-pencil-square-o"></i> How to change account password?</a>
    //                         </div>
    //                         <div class="article-info">
    //                             <div class="art-date">
    //                                 <a href="#">
    //                                     <i class="fa fa-calendar-o"></i> 20 May, 2016 </a>
    //                             </div>
    //                             <div class="art-category">
    //                                 <a href="#">
    //                                     <i class="fa fa-folder"></i> Account Settings </a>
    //                             </div>
    //                             <div class="art-comments">
    //                                 <a href="#">
    //                                     <i class="fa fa-comments-o"></i> 4 Comments </a>
    //                             </div>
    //                         </div>
    //                         <div class="article-content">
    //                             <p class="block-with-text">
    //                                 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam sit amet finibus dui. Fusce ac nulla nec ex ornare vehicula
    //                                 non nec mi. Cras eget nisi sem. Cum sociis natoque penatibus et magnis dis parturient montes,
    //                                 nascetur ridiculus mus. Donec viverra faucibus magna sed interdum. Phasellus ultrices sagittis
    //                                 molestie. Sed sit amet nisl id risus egestas semper. In porta, arcu eu dignissim vestibulum,
    //                                 sapien justo imperdiet enim, sed facilisis quam justo in neque. Aliquam fermentum arcu eget
    //                                 hendrerit efficitur.
    //                             </p>
    //                         </div>
    //                         <div class="article-read-more">
    //                             <a href="单个回答.html" class="btn btn-default btn-wide">Read more...</a>
    //                         </div>
    //                     </div>

    //add answers
    // var answers = dic["Answers"].get().then(function(querySnapshot1){
    //     querySnapshot1.forEach(function(doc1){
    //         var dic1 = doc1.data();
    //         var author1 = dic1["Author"];
    //         var content = dic1["Content"];
    //         var likes = dic1["Likes"];
    //         var approve = dic1["Approved"];
    //     });
    // });
    </script>
</head>

<body>
    <div class="container-fluid featured-area-white-border">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="login-box border-right-1">
                        <a href="个人信息.html">
                            <i class="fa fa-key"></i> 登陆</a>
                    </div>
                    <div class="login-box border-left-1 border-right-1">
                        <a href="email-password.html">
                            <i class="fa fa-pencil"></i> 注册</a>
                    </div>
                    <div class="login-box border-right-1">
                        <a href="系统消息.html">
                            <i class="fa fa-bell"></i> 系统消息</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- TOP NAVIGATION -->
    <div class="container-fluid">
        <div class="navigation">
            <div class="row">
                <ul class="topnav">
                    <li></li>
                    <li>
                        <a href="index.html">
                            <i class="fa fa-home"></i> 首页</a>
                    </li>
                    <li>
                        <a href="提问.html">
                            <i class="fa fa-book"></i> 提问</a>
                    </li>
                    <li>
                        <a href="回答.html">
                            <i class="fa fa-file-text-o"></i> 回答</a>
                    </li>
                    <li class="icon">
                        <a href="javascript:void(0);" onclick="myFunction()">&#9776;</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- END TOP NAVIGATION -->
    <!-- SEARCH FIELD AREA -->
    <div class="searchfield bg-hed-six">
        <div class="container" style="padding-top: 20px; padding-bottom: 20px;">
            <div class="row text-center margin-bottom-20">
                <h1 class="white"> IT LOVE</h1>
            </div>
            <br>
            <div class="row search-row">
                <input type="text" class="search" placeholder="搜索你感兴趣的内容" id="searchcontent">
                <button onclick="search()">搜索</button>
            </div>
        </div>
    </div>
    <!-- END SEARCH FIELD AREA -->
    <!-- MAIN SECTION -->
    <div class="container featured-area-default padding-30">
        <div class="row">
            <!-- ARTICLE OVERVIEW SECTION -->
            <div class="col-md-8 padding-20">
                <div class="row">
                    <!-- BREADCRUMBS -->
                    <div class="breadcrumb-container">
                        <ol class="breadcrumb">
                            <li>
                                <a href="index.html">
                                    <i class="fa fa-home"></i>
                                </a>
                            </li>
                            <li class="active"> 所有问题</li>
                        </ol>
                        <div class="sort">
                            <a href=# class="btn btn-default btn-wide"> 升序</a>
                            <a href=# class="btn btn-default btn-wide"> 降序</a>
                        </div>
                    </div>
                    <!-- END BREADCRUMBS -->
                    <!-- ARTICLES -->
                    <div id="allQ">
                        <div class="fb-heading">
                            所有问题
                        </div>
                        <hr class="style-three">
                        <div class="panel panel-default">
                            <div class="article-heading-abb">
                                <a href="单个回答.html">
                                <i class="fa fa-pencil-square-o"></i> How to change account password?</a>
                            </div>
                            <div class="article-info">
                                <div class="art-date">
                                    <a href="#">
                                    <i class="fa fa-calendar-o"></i> 20 May, 2016 </a>
                                </div>
                                <div class="art-category">
                                    <a href="#">
                                    <i class="fa fa-folder"></i> Account Settings </a>
                                </div>
                                <div class="art-comments">
                                    <a href="#">
                                    <i class="fa fa-comments-o"></i> 4 Comments </a>
                                </div>
                            </div>
                            <div class="article-content">
                                <p class="block-with-text">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam sit amet finibus dui. Fusce ac nulla nec ex ornare vehicula non nec mi. Cras eget nisi sem. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec viverra faucibus magna sed interdum. Phasellus ultrices sagittis molestie. Sed sit amet nisl id risus egestas semper. In porta, arcu eu dignissim vestibulum, sapien justo imperdiet enim, sed facilisis quam justo in neque. Aliquam fermentum arcu eget hendrerit efficitur.
                                </p>
                            </div>
                            <div class="article-read-more">
                                <a href="单个回答.html" class="btn btn-default btn-wide">Read more...</a>
                            </div>
                        </div>
                    </div>
                    <!-- PAGINATION -->
                    <nav class="text-center">
                        <ul class="pagination">
                            <li class="disabled">
                                <a href="#" aria-label="Previous">
                                    <span aria-hidden="true">
                                        <i class="fa fa-arrow-circle-left"></i> 上一页</span>
                                </a>
                            </li>
                            <li class="active">
                                <a href="#">1
                                    <span class="sr-only">(current)</span>
                                </a>
                            </li>
                            <li class="enabled">
                                <a href="#">2
                                    <span class="sr-only">(current)</span>
                                </a>
                            </li>
                            <li class="enabled">
                                <a href="#">3
                                    <span class="sr-only">(current)</span>
                                </a>
                            </li>
                            <li class="enabled">
                                <a href="#" aria-label="Previous">
                                    <span aria-hidden="true">下一页
                                        <i class="fa fa-arrow-circle-right"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <!-- END PAGINATION -->
                </div>
            </div>
            <!-- END ARTICLES OVERVIEW SECTION-->
            <!-- SIDEBAR STUFF -->
            <div class="col-md-4 padding-20">
                <div class="row margin-top-20">
                    <div class="col-md-12">
                        <div class="fb-heading-small">
                            最火的问题
                        </div>
                        <hr class="style-three">
                        <div class="fat-content-small padding-left-10">
                            <ul>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-file-text-o"></i> How to change account password?</a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-file-text-o"></i> How to edit order details?</a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-file-text-o"></i> Add new user</a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-file-text-o"></i> Change customer details</a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-file-text-o"></i> Lookup existing customer in order form</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END SIDEBAR STUFF -->
        </div>
    </div>
    <!-- END MAIN SECTION -->
    <!-- LOADING MAIN JAVASCRIPT -->
    <script src="../js/jquery-2.2.4.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src='https://cdn.rawgit.com/VPenkov/okayNav/master/app/js/jquery.okayNav.js'></script>
    <script>
    function search() {
        var content = "" + document.getElementById("searchcontent").value;
        console.log(content);
        window.open('https://it-love1.firebaseapp.com/search/' + content, "_self");
    }
    </script>
</body>

</html>