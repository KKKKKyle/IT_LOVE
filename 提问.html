<!DOCTYPE html>
<html lang="zh">

<head>
    <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
    <script src="js/init.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IT LOVE提问</title>
    <!-- LOADING STYLESHEETS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
    <script>
    var config = {
        apiKey: "AIzaSyBZUz6V1Mkmwxpe781P8X6ZC7fPTUyiBIg",
        authDomain: "it-love1.firebaseapp.com",
        databaseURL: "https://it-love1.firebaseio.com",
        projectId: "it-love1",
        storageBucket: "it-love1.appspot.com",
        messagingSenderId: "782043275132"
    };
    firebase.initializeApp(config);
    </script>
</head>

<body>
    <div class="container-fluid featured-area-white-border">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="login-box border-right-1">
                        <a href="个人信息.html">
                            <i class="fa fa-key"></i> 登陆</a>
                    </div>
                    <div class="login-box border-left-1 border-right-1">
                        <a href="email-password.html">
                            <i class="fa fa-pencil"></i> 注册</a>
                    </div>
                    <div class="login-box border-right-1">
                        <a href="系统消息.html">
                            <i class="fa fa-bell"></i> 系统消息</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--   <script src="/__/firebase/5.0.0/firebase-app.js"></script>
  <script src="/__/firebase/5.0.0/firebase-auth.js"></script>
  <script src="/__/firebase/5.0.0/firebase-storage.js"></script>
  <script src="/__/firebase/init.js"></script> -->
    <!-- TOP NAVIGATION -->
    <div class="container-fluid">
        <div class="navigation">
            <div class="row">
                <ul class="topnav">
                    <li></li>
                    <li>
                        <a href="index.html">
                            <i class="fa fa-home"></i> 首页</a>
                    </li>
                    <li>
                        <a href="提问.html">
                            <i class="fa fa-book"></i> 提问</a>
                    </li>
                    <li>
                        <a href="回答.html">
                            <i class="fa fa-file-text-o"></i> 回答</a>
                    </li>
                    <li class="icon">
                        <a href="javascript:void(0);" onclick="myFunction()">&#9776;</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- END TOP NAVIGATION -->
    <!-- SEARCH FIELD AREA -->
    <div class="searchfield bg-hed-six">
        <div class="container" style="padding-top: 20px; padding-bottom: 20px;">
            <div class="row text-center margin-bottom-20">
                <h1 class="white"> IT LOVE</h1>
            </div>
            <br>
            <div class="row search-row">
                <input type="text" class="search" placeholder="搜索你感兴趣的内容" id="searchcontent">
                <button onclick="search()">搜索</button>
            </div>
        </div>
    </div>
    <!-- END SEARCH FIELD AREA -->
    <!-- MAIN SECTION -->
    <div class="container featured-area-default padding-30">
        <div class="row">
            <div class="col-md-8 padding-20">
                <form>
                    <div class="form-row">
                        <div class="col">
                            <input type="text" class="form-control" placeholder="问题描述">
                        </div>
                        <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">
                            <main class="mdl-layout__content ">
                                <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
                                    <!-- Container for the demo -->
                                    <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
                                        <div class="mdl-card__title mdl-color--light-blue-600 mdl-color-text--white">
                                            <h2 class="mdl-card__title-text">上传聊天记录</h2>
                                        </div>
                                        <div class="mdl-card__supporting-text mdl-color-text--grey-600" id="messagesDiv">
                                            <p>选择聊天截图，当它成功上传，你可以看到图片链接。</p>
                                            <h6>选择文件</h6>
                                            <button type="button" onclick="addAnotherFile()">添加聊天记录</button>
                                            <input type="file" id="files" name="files[]" multiple />
                                            <!--   <input type="file" id="file" name="file"/> -->
                                            <h6>文件地址:</h6>
                                            <span id="linkbox"></span>
                                        </div>
                                    </div>
                                </div>
                            </main>
                        </div>
                        <div class="form-check col-md-8 padding-20 add-button">
                            <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                发布到公共社区
                            </label>
                        </div>
                    </div>
                </form>
                <div id="add-solution">
                    <button onclick="myButtonFunction()">提出解决方案</button>
                </div>
            </div>
            
        </div>
    </div>
    <!-- END MAIN SECTION -->
    <!-- LOADING MAIN JAVASCRIPT -->
    <script src="js/jquery-2.2.4.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src='https://cdn.rawgit.com/VPenkov/okayNav/master/app/js/jquery.okayNav.js'></script>
    <script>
    var auth = firebase.auth();

    var storageRef = firebase.storage().ref();

    function handleFileSelect(evt) {
        console.log("test");
        evt.stopPropagation();
        evt.preventDefault();
        var file = evt.target.files[0];

        var metadata = {
            'contentType': file.type

        };

        // Push to child path.
        // [START oncomplete]
        // console.log(user.uid);
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                var email = "" + user.email;
                storageRef.child('image/' + file.name).put(file, metadata).then(function(snapshot) {
                    console.log('Uploaded', snapshot.totalBytes, 'bytes.');
                    console.log('File metadata:', snapshot.metadata);
                    // Let's get a download URL for the file.
                    snapshot.ref.getDownloadURL().then(function(url) {
                        console.log('File available at', url);
                        var db = firebase.firestore();
                        var ref = db.collection("user");
                        ref.doc(email).collection("Questions").doc().set({ image: "" + url });
                    });
                }).catch(function(error) {
                    // [START onfailure]
                    console.error('Upload failed:', error);
                    // [END onfailure]
                });
            } else {
                // No user is signed in.
            }
        });
    }
    // });
    //       storageRef.child('image/' + file.name).put(file, metadata).then(function(snapshot) {
    //         console.log("test1");
    //         console.log('Uploaded', snapshot.totalBytes, 'bytes.');
    //         console.log('File metadata:', snapshot.metadata);
    //         // Let's get a download URL for the file.
    //         snapshot.ref.getDownloadURL().then(function(url) {
    //           console.log('File available at', url);
    //           // [START_EXCLUDE]
    //           document.getElementById('linkbox').innerHTML = '<a href="' +  url + '">Click For File</a>';
    //           // [END_EXCLUDE]
    //         });
    //       }).catch(function(error) {
    //         // [START onfailure]
    //         console.error('Upload failed:', error);
    //         // [END onfailure]
    //       });
    //       // [END oncomplete]
    //     }

    // window.onload = function() {
    //   document.getElementById('file').addEventListener('change', handleFileSelect, false);
    //   document.getElementById('file').disabled = false;

    // auth.onAuthStateChanged(function(user) {
    //   if (user) {
    //     console.log('Anonymous user signed-in.', user);
    //     document.getElementById('file').disabled = false;
    //   } else {
    //     console.log('There was no anonymous session. Creating a new anonymous user.');
    //     // Sign the user in anonymously since accessing Storage requires the user to be authorized.
    //     auth.signInAnonymously().catch(function(error) {
    //       if (error.code === 'auth/operation-not-allowed') {
    //         window.alert('Anonymous Sign-in failed. Please make sure that you have enabled anonymous ' +
    //             'sign-in on your Firebase project.');
    //       }
    //     });
    //   }
    // });

    function addAnotherFile() {
        // <button id="clickMe" onclick="addAnotherFile()">添加聊天记录</button>
        // <input type="file" id="file" name="file"/>
        //<input type="file" id="files" name="files[]" multiple />

        var div = document.createElement('div');
        // var btn = document.createElement("button");
        var i = document.createElement("input");
        // btn.setAttribute('onclick',"addAnotherFile()");
        // btn.text = "test";
        i.setAttribute('type', "file");
        i.setAttribute('name', "file");
        i.setAttribute('id', "file");
        div.appendChild(i);
        // div.appendChild(btn);

        document.getElementById("messagesDiv").appendChild(div);
        console.log("Test");
    }
    // function initApp(){
    //     document.getElementById("clickMe").addEventListener('click', addAnotherFile, false);
    // }
    // window.onload = function() {
    //     initApp();
    // };
    </script>
    <script>
    function search() {
        var content = "" + document.getElementById("searchcontent").value;
        console.log(content);
        window.open('https://it-love1.firebaseapp.com/search/' + content, "_self");
    }
    </script>
</body>

</html>